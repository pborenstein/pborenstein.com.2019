<!DOCTYPE html>
<html lang="en">
<head>

  <title>Under the Hood</title>
  <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
  <link href="/assets/styles/styles.css"    rel="stylesheet" type="text/css"  />
  <link href="/assets/styles/docstyles.css" rel="stylesheet" type="text/css" />
  <link href="/assets/styles/prettify.css"  rel="stylesheet" type="text/css" />
  <script src="/assets/js/prettify.js" type="text/javascript"></script>
  <script src="/assets/js/prettify.js" type="text/javascript"></script>
  <script src="//ajax.googleapis.com/ajax/libs/jquery/1.7.2/jquery.min.js" type="text/javascript"></script>


    <script type="text/javascript">
      $(document).ready(function() {
          $('pre').each(function() {
              var thepre = $(this);
              if (thepre.hasClass('javascript') ||
                  thepre.hasClass('js') ||
                  thepre.hasClass('shell') ||
                  thepre.hasClass('bash')
                 )
                thepre.addClass('prettyprint');
          });
          prettyPrint();
      });
    </script>



</head>

<body>

  <div id="header">
      <div style="margin: 10px 10px">
        <p>
          Philip Borenstein: Writing sample <br/>
          This is a snapshot of this topic when I wrote it.<br/>
          You can find the current version in the
          <a href="http://docs.joyent.com">Joyent documentation.</p>
        </p>
      </div>
  </div>
  <div id="sidebar">
    <div class="menu">
      <form id="search" action="/search"><input type="search" name="q" placeholder="Search..."></form>
      
<ul>

  
	
	<li class="depth-1">

	<a href="/rbac">Role Based Access Control</a>

			
<ul>

  
	
	<li class="depth-2 hasChildren">

	<a href="/rbac/quickstart">Getting Started with Access Control: CLI</a>

			
	</li>

	
	<li class="depth-2">

	<a href="/rbac/portal">Getting Started with Access Control: Portal</a>

			
	</li>

	
	<li class="depth-2">

	<a href="/rbac/cloudapi">Using Access Control with CloudAPI</a>

			
	</li>

	
	<li class="depth-2">

	<a href="/rbac/users">Working with Users</a>

			
	</li>

	
	<li class="depth-2">

	<a href="/rbac/roles">Working with Roles</a>

			
	</li>

	
	<li class="depth-2">

	<a href="/rbac/policies">Working with Policies</a>

			
	</li>

	
	<li class="depth-2">

	<a href="/rbac/rules">Working with Rules</a>

			
	</li>

	
	<li class="depth-2">

	<a class="active" href="/rbac/underthehood">Under the Hood</a>

			
<ul>

  
	
</ul>

	</li>

	
</ul>

	</li>

	
</ul>
    </div>
        <div class="footblock">
    <p>Â© 2015 <a href="http://joyent.com">Joyent, Inc.</a> | <a href="mailto:&#115;&#x75;&#x70;&#112;&#x6f;&#114;&#x74;&#x40;&#106;&#x6f;&#121;&#101;&#x6e;&#116;&#x2e;&#x63;&#x6f;&#109;">Questions, comments, feeback.</a></p></div>
  </div>
<div id="content" class="content">
    <nav class="breadcrumb">
	<ul>
					<li><a href="/">Home &rsaquo;</a></li>
					<li><a href="/rbac">Role Based Access Control &rsaquo;</a></li>
			</ul>
</nav>    <h1>Under the Hood</h1>
    <div class="infoblock">
                
    <div class="stability_3 stability">
        Stability: <a href="/stability">Stable</a>
    </div>
    </div>
    <p>Access control allows you to control access to your data by specifying rules
that describe who can access what and under what conditions. Rules can be
broken down to four logical components.</p>
<ul>
<li>Principal<br>
The &quot;subject&quot;, or the identity the rule applies to e.g. Bob
the Contractor. Principals in the Joyent Cloud are users.</li>
<li>Action<br>
The &quot;verb&quot;, or the action a user takes e.g., PutObject, CreateJob</li>
<li>Resource<br>
The &quot;object&quot;, or target of the action e.g., machine, Manta object</li>
<li>Context<br>
Any extra constraints e.g. &quot;between 08:00-17:00&quot;, &quot;from eu-ams1&quot;</li>
</ul>
<p>Rules for access control for Joyent Cloud are written with the
<a href="https://github.com/joyent/node-aperture">Aperture</a>
access control language. With Aperture, you can define rules with each of the
components above in a human-readable way.</p>
<p>For a request to be authorized, the principal, action, resource, and context for
the request are evaluated against any relevant rules. If any of the rules grant
access, the request is authorized. The Aperture evaluation engine is used to
authorize requests.</p>
<p>When making a request as a user, a list of rules along with the request context
is evaluated using Aperture. The list of rules comes from a set of roles that
are relevant to this request. Relevant roles are the roles that</p>
<ul>
<li>are part of the user's limit set of roles, and</li>
<li>are active for the request, whether by default or explicitly specified, and</li>
<li>are in the list of role tags on the resource.</li>
</ul>
<p>For a rule to evaluate to true, the action and conditions from the rule have
to match the action and conditions from the request.</p>
<p>If <em>any</em> of the rules from the relevant roles evaluate to true (an OR across
rules), the request is authorized.</p>
<p>As mentioned earlier, the policies' rules use
<a href="https://github.com/joyent/node-aperture#policy-language">Aperture Policy Language</a>,
with the following <em>basic format</em>:</p>
<p><code>&lt;principals&gt; CAN &lt;actions&gt; &lt;resources&gt; WHEN &lt;conditions&gt;</code>.</p>
<p>In the case of CloudAPI or Manta,
<code>&lt;principal&gt;</code> is always the user performing the request.
Likewise, <code>&lt;resource&gt;</code> is the Manta object or CloudAPI URL
of such request.</p>
<p>Therefore, Manta and CloudAPI's Aperture rules have the format:</p>
<pre><code>    CAN &lt;actions&gt; WHEN &lt;conditions&gt;</code></pre>
<p>By default, the access policy will <code>DENY</code> any attempt made by any account
user to access a given resource, unless:</p>
<ul>
<li>that resource is tagged with a role</li>
<li>that role is active</li>
<li>that role has a policy</li>
<li>that policy contains a rule which explicity <code>GRANTS</code> access to that resource</li>
</ul>
<p>For example, a user with an active role <code>read</code>, which includes a policy rule
like <code>CAN listmachines and getmachines</code> will not get access to resources like
<code>/:account/machines</code> or <code>/:account/machines/:machine_id</code> unless these resources
are <em>role-tagged</em> with the role <code>read</code> too.</p>
<p>Additionally, given that the <code>&lt;actions&gt;</code> included in the policy rule are just
<code>listmachines</code> and <code>getmachine</code>, the user will be able to retrieve a machine's
details provided by the GetMachine action, but will not be able
to perform any other machine actions (like StopMachine).
However, if the role has a rule including that <code>&lt;action&gt;</code> (like StopMachine), or
the user has an additional role which includes that rule, then the user can
invoke that action too.</p></div>
<div style="clear:both"></div>
</body>

</html>
