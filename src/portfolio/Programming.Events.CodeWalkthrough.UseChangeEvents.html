<html xmlns:cogdoc="http://www.cognex.com/cogdoc">
<head>
<META http-equiv="Content-Type" content="text/html; charset=UTF-8">
<link rel="stylesheet" type="text/css" href="msdn.css">
<TITLE>Using Changed Events</TITLE>
</head>
<body topmargin="0" id="bodyID" class="dtBODY">
<div id="nsbanner">
<div id="bannerrow1">
<TABLE CLASS="bannerparthead" CELLSPACING="0">
<TR ID="hdr">
<TD CLASS="runninghead" nowrap="">Users Guide</TD>
</TR>
</TABLE>
</div>
<div id="TitleRow">
<H1 class="dtH1">Using Changed Events</H1>
</div>
</div>
<div id="nstext" valign="bottom">
<p>In many applications, you may want to perform an action in response to a change in the value of an object's property.
	For example, if the contrast or brightness of an acquisition FIFO changes, you may want to acquire a new image.
	Or you may want to change a vision tool's parameters in response to a shape change.
	Most VisionPro properties fire a 
	<a href="ms-its:ProgrammingReference.chm::/Cognex.VisionPro.ICogChangedEvent.Changed.html">Changed</a> event
	when their value changes.
	You can write a changed event handler to perform an action when the value of a property changes.
	
	Some VisionPro objects fire other events in addition to changed events.
	Interactive graphics, for example, fire 
	<a href="ms-its:ProgrammingReference.chm::/Cognex.VisionPro.ICogGraphicInteractive.Dragging.html">Dragging</a>
	and
	 
	events when a graphic object is dragged.
</p>
<p>To learn more about events, see the <a href="ms-its:UsersGuide.chm::/Programming.Events.Theory.Events.html">About Events in VisionPro</a> theory topic.</p>
<p>This example shows you how to write an event handler for an <a href="ms-its:ProgrammingReference.chm::/Cognex.VisionPro.ICogAcqFifo.html">ICogAcqFifo</a>
	that acquires a new image whenever the <a href="ms-its:ProgrammingReference.chm::/Cognex.VisionPro.ICogAcqBrightness.Brightness.html">brightness</a> or
	<a href="ms-its:ProgrammingReference.chm::/Cognex.VisionPro.ICogAcqContrast.Contrast.html">contrast</a> properties change.
	The brightness and contrast values can be changed two ways:
		with a slider, and
		by resetting the values with a button.
	Although you could insert the reacquisition code in each of the controls, in this example the code will be in the FIFO's changed event handler. 
	This approach avoids the duplication of code, improves maintainability, and ensures that the reacquisition takes place regardless of
	how the brightness or contrast values are changed.
</p>
<p class="note"><b>Note: </b>
		If you are using QuickBuild and using your own changed event handler, bear in mind that QuickBuild may change properties
		(such as triggering) that may invoke your changed even handler. Your changed event handler must be able to handle this case.
	</p>
<h1><a name="#before_you_begin"></a>Before You Begin</h1>
<p>This example assumes that you have installed VisionPro and that you are familiar with
	<a href="ms-its:UsersGuide.chm::/Acquisition.General.CodeWalkthrough.Acquiring.html">acquiring images</a>
	using an <a href="ms-its:ProgrammingReference.chm::/Cognex.VisionPro.ICogAcqFifo.html">acquisition FIFO</a> and with
	<a href="ms-its:UsersGuide.chm::/Display.Images.CodeWalkthrough.DisplayImage.html">displaying images </a>.
	</p>
<p>The examples in this walkthrough are given in both C# and Visual Basic.</p>
<h1><a name="#initialize_the_fifo_and_controls"></a>Initialize the FIFO and Controls</h1>
<p>
	The <b>InitialzieFifo</b> function initializes the acquisition FIFO, the two sliders, and the reset button.
	<b>sldBrightness</b> and <b>sldContrast</b> are the sliders. <b>btnReset</b>
	is the reset button.
	The highlighted line shows how to associate the event handler, <b>mAcqFifo_Changed</b>
	with the acquisition FIFO's changed event.
	</p>
<p>C# Code</p>
<pre class="code">
private ICogAcqFifo mAcqFifo = null;
private ICogFrameGrabber mFrameGrabber = null;
private int numAcqs = 0;
private ICogAcqBrightness mBrightness;
private ICogAcqContrast mContrast;
private double _defaultBrightness, _defaultContrast;

private void InitializeFifo()
{
    CogFrameGrabbers mFrameGrabbers = new CogFrameGrabbers();
    String videoFormat = "Sony XC75 640x480";

    mFrameGrabber = mFrameGrabbers[0];
    mAcqFifo = mFrameGrabber.CreateAcqFifo(videoFormat, CogAcqFifoPixelFormatConstants.Format8Grey,0,true);

    mBrightness = mAcqFifo.OwnedBrightnessParams;
    mContrast = mAcqFifo.OwnedContrastParams;
    _defaultBrightness = mBrightness.Brightness;
    _defaultContrast = mContrast.Contrast;

    sldBrightness.Value = (int) (mBrightness.Brightness * 100);
    sldContrast.Value = (int) (mContrast.Contrast * 100);

    <b>mAcqFifo.Changed += new CogChangedEventHandler(mAcqFifo_Changed);</b>
}
</pre>
<p>VB.NET Code</p>
<pre class="code">
Private mAcqFifo As Cognex.VisionPro.ICogAcqFifo = Nothing
Private mFrameGrabber As Cognex.VisionPro.ICogFrameGrabber = Nothing
Private numAcqs As Integer = 0
Private mBrightness As ICogAcqBrightness
Private mContrast As ICogAcqContrast
Private _defaultBrightness As Double
Private _defaultContrast As Double

Private Sub InitializeFifo()
    Dim videoFormat As String = "Sony XC75 640x480"    
    mAcqFifo = mFrameGrabber.CreateAcqFifo(videoFormat, CogAcqFifoPixelFormatConstants.Format8Grey, 0, True)

    mBrightness = mAcqFifo.OwnedBrightnessParams
    mContrast = mAcqFifo.OwnedContrastParams
    _defaultBrightness = mBrightness.Brightness
    _defaultContrast = mContrast.Contrast

    sldBrightness.Value = mBrightness.Brightness * 100
    sldContrast.Value = mContrast.Contrast * 100
            
    <b>AddHandler mAcqFifo.Changed, AddressOf mAcqFifo_Changed</b>
End Sub
</pre>
<h1><a name="#write_the_acquisition_fifo_event_handler"></a>Write the Acquisition FIFO Event Handler</h1>
<p>
All changed events for the acquisition FIFO are handled by <b>mAcqFifo_Changed</b>. </p>
<p>C# Code</p>
<pre class="code">
private void mAcqFifo_Changed(object sender, CogChangedEventArgs e) {
    if (  ((e.StateFlags &amp; CogAcqFifoStateFlags.SfBrightness) != 0) || ((e.StateFlags &amp; CogAcqFifoStateFlags.SfContrast) != 0 )) {
        int trignum;
        cogDisplay1.Image = ((ICogAcqFifo) sender).Acquire(out trignum);
        numAcqs++;
        if (numAcqs &gt; 4) {
            GC.Collect();
            numAcqs = 0;
        }
    }
}
</pre>
<p>VB.NET Code</p>
<pre class="code">
Private Sub mAcqFifo_Changed(ByVal sender As System.Object, ByVal e As Cognex.VisionPro.CogChangedEventArgs)
    If (e.StateFlags And CogAcqFifoStateFlags.SfBrightness &lt;&gt; 0) Or _
       (e.StateFlags And CogAcqFifoStateFlags.SfContrast &lt;&gt; 0) Then
        Dim trignum As Integer
        cogDisplay1.Image = CType(sender, ICogAcqFifo).Acquire(trignum)
        numAcqs += 1
        If numAcqs &gt; 4 Then
            GC.Collect()
            numAcqs = 0
    End If
End Sub
</pre>
<p>The <b>sender</b> parameter is a reference to the object that raised the event.
	In this case it is an <a href="ms-its:ProgrammingReference.chm::/Cognex.VisionPro.ICogAcqFifo.html">ICogAcqFifo</a>.
	</p>
<p>The <b>e</b> parameter is <a href="ms-its:ProgrammingReference.chm::/Cognex.VisionPro.CogChangedEventArgs.html">CogChangedEventArgs</a> object whose
	<a href="ms-its:ProgrammingReference.chm::/Cognex.VisionPro.CogChangedEventArgs.StateFlags.html">StateFlags</a> property is a set of bit flags that describes which
	aspects of the acquisition FIFO have changed.
	</p>
<p>If you want to use the changed event to limit the value of a property, you must change the property itself, not the value parameter.</p>
<h1><a name="#write_the_slider_code"></a>Write the Slider Code</h1>
<p>In this example, the form contains two sliders named <b>sldBrightness</b> and <b>sldContrast</b>.
	The <b>Maximum</b> property of both sliders to 100. The brightness and contrast values range from 0.0 to 1.0. The values of the sliders range from 0 to 100. You need to multiply the contrast and brightness values to set the sliders.
	</p>
<p>The code to change the contrast and brightness values with the slider is simple.
	This example implements it in the sliders' <b>Scroll</b> event handler so that the values change as you slide the slider.
	</p>
<p>C# Code</p>
<pre class="code">
private void sldBrightness_Scroll(object sender, System.EventArgs e) {
    mBrightness.Brightness = ((System.Windows.Forms.TrackBar) sender).Value / 100.0;
}

private void sldContrast_Scroll(object sender, System.EventArgs e) {
    mContrast.Contrast = ((System.Windows.Forms.TrackBar) sender).Value / 100.0;
}
	</pre>
<p>VB.NET Code</p>
<pre class="code">
Private Sub sldBrightness_Scroll(ByVal sender As System.Object, ByVal e As System.EventArgs) Handles sldBrightness.Scroll
    mBrightness.Brightness = CType(sender, System.Windows.Forms.TrackBar).Value / 100.0
End Sub

Private Sub sldContrast_Scroll(ByVal sender As System.Object, ByVal e As System.EventArgs) Handles sldContrast.Scroll
    mContrast.Contrast = CType(sender, System.Windows.Forms.TrackBar).Value / 100.0
End Sub
	</pre>
<p>If you slide the sliders now, the image will change because the acquisition FIFO's changed event fires
	when the brightness and contrast values change.</p>
<h1><a name="#write_the_reset_button_code"></a>Write the Reset Button Code</h1>
<p>A reset button on the form sets the contrast and brightness back to their initial values. The <b>Click</b> handler for the
	button looks like this:
	</p>
<p>C# Code</p>
<pre class="code">
private void btnReset_Click(object sender, System.EventArgs e) {
    mBrightness.Brightness = _defaultBrightness;
    mContrast.Contrast = _defaultContrast;
}
	</pre>
<p>VB.NET Code</p>
<pre class="code">
Private Sub btnReset_Click(ByVal sender As System.Object, ByVal e As System.EventArgs) Handles btnReset.Click
    mBrightness.Brightness = _defaultBrightness
    mContrast.Contrast = _defaultContrast
End Sub
</pre>
<p>The only problem now is to make sure that the sliders get updated as well. You could rewrite your acquisition FIFO changed event handler like this:</p>
<p>C# Code</p>
<pre class="code">
private void mAcqFifo_Changed(object sender, CogChangedEventArgs e) {
     bool _needNewImage = false;

    if ( (e.StateFlags &amp; CogAcqFifoStateFlags.SfBrightness) != 0) {
        _needNewImage = true;
        sldBrightness.Value = (int) (((ICogAcqFifo) sender).OwnedBrightnessParams.Brightness * 100);
    }
    if ( (e.StateFlags &amp;' CogAcqFifoStateFlags.SfContrast) != 0) {
        _needNewImage = true;
        sldContrast.Value = (int) (((ICogAcqFifo) sender).OwnedContrastParams.Contrast * 100);
    }

    if (_needNewImage) {
        int trignum;
        cogDisplay1.Image = ((ICogAcqFifo) sender).Acquire(out trignum);
        numAcqs++;
        if (numAcqs &gt; 4) {
            GC.Collect();
            numAcqs = 0;
    }
}
</pre>
<p>VB.NET Code</p>
<pre class="code">
Private Sub mAcqFifo_Changed(ByVal sender As System.Object, ByVal e As Cognex.VisionPro.CogChangedEventArgs)
    Dim _needNewImage As Boolean = False

    If e.StateFlags And CogAcqFifoStateFlags.SfBrightness &lt;&gt; 0 Then
        _needNewImage = True
        sldBrightness.Value = CType(sender, ICogAcqFifo).OwnedBrightnessParams.Brightness * 100
    End If

    If e.StateFlags And CogAcqFifoStateFlags.SfContrast &lt;&gt; 0 Then
        _needNewImage = True
        sldContrast.Value = CType(sender, ICogAcqFifo).OwnedContrastParams.Contrast * 100
    End If

    If _needNewImage Then
        Dim trignum As Integer
        cogDisplay1.Image = mAcqFifo.Acquire(trignum)
        numAcqs += 1
        If numAcqs &gt; 4 Then
            GC.Collect()
            numAcqs = 0
        End If
    End If
End Sub
</pre>
</div>
<DIV CLASS="footer"><br><HR>
<p><a href="copyright.html">Â© 2008 Cognex Corporation. All rights reserved.</a></p>
</DIV>
</body>
</html>
